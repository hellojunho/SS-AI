{% extends "admin/base_site.html" %}
{% load i18n static admin_categories %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'admin/admin-categories.css' %}">
{% endblock %}

{% block content %}
<div id="content-main" class="admin-category-page">
  {% get_admin_categories app_list as categories %}
  {% if categories %}
    <div class="admin-category-grid">
      {% for category in categories %}
        <section class="admin-category-card">
          <header class="admin-category-header">
            <h2>{{ category.title }}</h2>
          </header>
          <div class="admin-category-body">
            {% for model in category.models %}
              {% with row_url=model.admin_url|default:model.add_url %}
                <div class="admin-category-row{% if row_url %} is-clickable{% endif %}"{% if row_url %} data-url="{{ row_url }}"{% endif %}>
                <span class="admin-category-label">{{ model.name }}</span>
                <div class="admin-category-actions">
                  {% if model.add_url %}
                    <a class="admin-category-action is-add" href="{{ model.add_url }}">{% translate 'Add' %}</a>
                  {% endif %}
                  {% if model.admin_url %}
                    <a class="admin-category-action is-change" href="{{ model.admin_url }}">{% translate 'Change' %}</a>
                  {% endif %}
                </div>
              </div>
              {% endwith %}
            {% endfor %}
          </div>
        </section>
      {% endfor %}
    </div>
  {% else %}
    <p>{% translate "You don't have permission to view or edit anything." %}</p>
  {% endif %}
</div>
<script>
  document.querySelectorAll('.admin-category-row.is-clickable').forEach((row) => {
    row.addEventListener('click', (event) => {
      if (event.target.closest('.admin-category-action')) return;
      const url = row.getAttribute('data-url');
      if (url) {
        window.location.href = url;
      }
    });
  });
</script>
{% endblock %}
